{"version":3,"file":"bundle_doricwebsocket.js","sources":["../build/lib/WebSocket.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/*\n * Copyright [2019] [Doric.Pub]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { modal, loge, log } from \"doric\";\nfunction websocket(context) {\n    return {\n        create: (onopen, onclose, onerror, onmessage) => {\n            return context.callNative('websocket', 'create', {\n                onopen: onopen,\n                onclose: onclose,\n                onerror: onerror,\n                onmessage: onmessage\n            });\n        },\n        open: (identifier, url) => {\n            return context.callNative('websocket', 'open', { identifier: identifier, url: url });\n        },\n        send: (identifier, data) => {\n            return context.callNative('websocket', 'send', { identifier: identifier, data: data });\n        },\n        close: (identifier) => {\n            return context.callNative('websocket', 'close', { identifier: identifier });\n        },\n        destroy: (identifier) => {\n            return context.callNative('websocket', 'destroy', { identifier: identifier });\n        },\n    };\n}\nexport class WebSocket {\n    constructor(context) {\n        this._onopen = () => {\n            if (this.onopen)\n                this.onopen();\n        };\n        this._onerror = () => {\n            if (this.onerror)\n                this.onerror();\n        };\n        this._onclose = () => {\n            if (this.onclose)\n                this.onclose();\n        };\n        this._onmessage = (message) => {\n            log(\"_onmessage : \" + message);\n            let strings = message.split(',');\n            let length = strings.length - 1;\n            let arrayBuffer = new ArrayBuffer(length);\n            let dataView = new DataView(arrayBuffer);\n            for (let index = 0; index < length; index++) {\n                dataView.setUint8(index, parseInt(strings[index]));\n            }\n            if (this.onmessage)\n                this.onmessage(arrayBuffer);\n        };\n        this.identifier = -1;\n        this.context = context;\n        let onopenFunction = context.function2Id(this._onopen);\n        let oncloseFunction = context.function2Id(this._onclose);\n        let onerrorFunction = context.function2Id(this._onerror);\n        let onmessageFunction = context.function2Id(this._onmessage);\n        let create = () => __awaiter(this, void 0, void 0, function* () {\n            return yield websocket(this.context).create(onopenFunction, oncloseFunction, onerrorFunction, onmessageFunction);\n        });\n        create().then((identifier) => {\n            this.identifier = identifier;\n        }).catch(() => { });\n    }\n    open(url) {\n        let open = () => __awaiter(this, void 0, void 0, function* () {\n            return yield websocket(this.context).open(this.identifier, url);\n        });\n        open();\n    }\n    send(arrayBuffer) {\n        log(\"send\");\n        let result = \"\";\n        let array = new Uint8Array(arrayBuffer);\n        loge(array.byteLength);\n        array.forEach(function (byte) {\n            result += `${byte},`;\n        });\n        let send = () => __awaiter(this, void 0, void 0, function* () {\n            return yield websocket(this.context).send(this.identifier, result);\n        });\n        send();\n    }\n    close() {\n        let close = () => __awaiter(this, void 0, void 0, function* () {\n            return yield websocket(this.context).close(this.identifier);\n        });\n        close().then((result) => { modal(this.context).toast(String(result)); }).catch(() => { });\n    }\n    destroy() {\n        let destroy = () => __awaiter(this, void 0, void 0, function* () {\n            return yield websocket(this.context).destroy(this.identifier);\n        });\n        destroy().then((result) => { modal(this.context).toast(String(result)); }).catch(() => { });\n    }\n}\n//# sourceMappingURL=WebSocket.js.map"],"names":["this","log","loge","modal"],"mappings":"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"}